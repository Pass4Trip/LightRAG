import os
import pandas as pd
from pathlib import Path
from dotenv import load_dotenv
from pymilvus import connections, Collection

def export_milvus_to_dataframe(collection_name="entities", filtered_ids=None):
    """
    Exporter une collection Milvus vers un DataFrame pandas selon un filtre d'IDs.
    
    :param collection_name: Nom de la collection Milvus
    :param filtered_ids: Liste des IDs √† filtrer (optionnel)
    :return: DataFrame pandas contenant les donn√©es de la collection
    """

    vec = [[-0.0019637153018265963,-0.026882946491241455,-0.045827023684978485,-0.0643930584192276,0.012979422695934772,-0.03152445703744888,-0.027050964534282684,0.02513975463807583,0.007608084008097649,-0.006599973421543837,0.017515920102596283,-0.003825044259428978,-0.0013677749084308743,-0.032889604568481445,-0.017148379236459732,0.07212190330028534,0.03559890016913414,-0.037216078490018845,0.016833344474434853,0.0012831094209104776,0.036586008965969086,-0.038728244602680206,-0.029529236257076263,-0.03786715120077133,0.06804745644330978,-0.006484460551291704,-0.037384096533060074,0.0047333939000964165,-0.007959872484207153,-0.01162477396428585,0.026420896872878075,-0.031335435807704926,-0.0018941451562568545,-0.018398016691207886,-0.02297651767730713,-0.017232388257980347,0.019490135833621025,0.01042239274829626,0.053219832479953766,0.007067274767905474,-0.002648915397003293,0.057084258645772934,0.05443796515464783,0.004859407432377338,0.016980361193418503,-0.017295395955443382,-0.03988337144255638,0.011120718903839588,-0.009970842860639095,0.0010967139387503266,-0.00859519187361002,-0.016896352171897888,-0.015573207288980484,-0.022241437807679176,0.0046703871339559555,-0.005358212161809206,0.007261545863002539,-0.006999017205089331,0.08216100931167603,0.06300690770149231,0.03448577970266342,-0.017641933634877205,-0.0039300560019910336,0.0113307423889637,-0.028227094560861588,0.045659005641937256,-0.00858469121158123,0.022388454526662827,-0.01641329936683178,0.023816609755158424,-0.029760261997580528,-0.02234645001590252,0.0020293474663048983,-0.028836160898208618,0.02421565353870392,-0.037510111927986145,0.003386621130630374,-0.03599794581532478,-0.009330272674560547,-0.04066045582294464,-0.05011149123311043,0.03267958015203476,-0.01833500899374485,-0.013546484522521496,0.023606587201356888,-0.06157875061035156,-0.06720736622810364,-0.010233371518552303,-0.015037648379802704,0.007991376332938671,0.047507207840681076,0.022073419764637947,0.00329473614692688,0.002197365742176771,0.02513975463807583,-0.014292066916823387,-0.03127242624759674,-0.010847688652575016,-0.04851531609892845,0.04376879706978798,0.015541703440248966,-0.02417364902794361,0.03186049312353134,-0.03624997287988663,0.08703354001045227,0.005859642289578915,0.02513975463807583,-0.0372580848634243,-0.028731148689985275,0.0015069151995703578,0.017137877643108368,0.015216168016195297,-0.001286391052417457,0.06334294378757477,-0.022997520864009857,-0.002638414269313216,-0.0011137783294543624,-0.046121057122945786,-0.039358314126729965,-0.005450097378343344,0.04389481246471405,0.006048663053661585,-0.056286171078681946,-0.02120182476937771,-0.03994637727737427,-0.04294970631599426,-0.010191367007791996,0.008637196384370327,-0.006783743388950825,-0.0918220654129982,0.008033380843698978,-0.02385861426591873,-0.014523091726005077,0.009745067916810513,0.023942625150084496,0.027302993461489677,0.01595124788582325,0.029487231746315956,0.01831400766968727,0.006179927382618189,0.0017195635009557009,-0.06309091299772263,0.010648166760802269,0.002223618794232607,0.01540518831461668,-0.04418884217739105,-0.07964073121547699,0.011530264280736446,0.08988985419273376,0.06388900429010391,-0.025160757824778557,-0.043810803443193436,0.017221888527274132,-0.06204080209136009,-0.04864133149385452,-0.015384186059236526,-0.013210448436439037,0.0023233797401189804,-0.031083406880497932,0.014607100747525692,-0.0626288652420044,0.000029349896067287773,0.007975623942911625,-0.02018321305513382,0.009057242423295975,0.02618987113237381,-0.06640928238630295,-0.026063857600092888,-0.00247170845977962,0.028395112603902817,-0.009697812609374523,0.010228120721876621,0.04658310487866402,0.058638427406549454,0.028143085539340973,0.021390844136476517,-0.019826173782348633,0.001218133489601314,-0.01801997423171997,-0.012874411419034004,0.007707844953984022,0.025832831859588623,0.0467931292951107,0.016770338639616966,0.03572491556406021,0.012401859275996685,-0.04931340366601944,-0.051833681762218475,0.026609916239976883,-0.005812386982142925,-0.040261413902044296,0.01394552830606699,-0.01117322500795126,0.001774694537743926,-0.007902116514742374,0.023375561460852623,0.009682061150670052,0.02419465221464634,-0.016518309712409973,0.0707777589559555,-0.03900127485394478,-0.01694885827600956,-0.03958933800458908,-0.012443863786756992,-0.007088277023285627,0.023060528561472893,0.030705366283655167,0.003982561640441418,-0.02648390270769596,0.004292345605790615,0.04313872754573822,0.005121936555951834,0.03169247508049011,0.04792725294828415,0.016234779730439186,0.0314614474773407,-0.0034863820765167475,-0.0024047635961323977,0.014386576600372791,0.0007731472724117339,-0.004825279116630554,-0.027197981253266335,0.05683222785592079,0.011981813237071037,-0.009734567254781723,0.03110441006720066,0.00063531962223351,-0.03144044801592827,-0.002845811890438199,-0.02110731415450573,-0.0672493726015091,-0.02096029743552208,-0.022619478404521942,-0.01118372566998005,-0.051833681762218475,0.0226614847779274,-0.04265567660331726,-0.00012338852684479207,-0.014113547280430794,-0.022220436483621597,-0.005549858324229717,-0.021485354751348495,-0.0018455772660672665,-0.022892508655786514,0.007392810191959143,-0.01901758462190628,-0.005253200884908438,-0.004557499662041664,0.0038959269877523184,0.016570815816521645,0.0514136366546154,0.02635788917541504,-0.018061980605125427,-0.05145563930273056,-0.0039248052053153515,-0.030117301270365715,-0.01704336889088154,-0.06052863597869873,0.014428581111133099,0.02726098895072937,0.005780883599072695,0.002858938416466117,0.023501576855778694,0.03450678288936615,-0.001991280820220709,0.03501083701848984,0.02774404175579548,0.0018770807655528188,0.019175101071596146,-0.0004856782325077802,-0.0271349735558033,-0.05132962763309479,-0.016108766198158264,0.05086757615208626,0.01279040239751339,-0.00880521535873413,-0.013378466479480267,0.016035256907343864,-0.006111669819802046,0.03034832701086998,-0.09383828192949295,-0.04269767925143242,-0.00654221698641777,-0.026147866621613503,-0.035031840205192566,-0.030138302594423294,0.045995041728019714,-0.03232254460453987,0.05700024589896202,0.015195165760815144,0.021222826093435287,-0.009808074682950974,-0.038119178265333176,0.039064280688762665,-0.010952700860798359,-0.011194227263331413,0.005300456192344427,0.0013677749084308743,0.03669102117419243,0.0038670487701892853,0.002525526797398925,-0.012149831280112267,0.010763679631054401,-0.027954064309597015,0.02543378807604313,-0.006032911129295826,-0.07207989692687988,0.049985479563474655,0.034590791910886765,0.04393681511282921,0.014197556301951408,0.026000849902629852,-0.040450435131788254,0.0021212324500083923,0.0038329202216118574,0.02728199027478695,0.03391871601343155,-0.0038171682972460985,-0.004476115573197603,0.002319441642612219,0.05620216205716133,-0.017295395955443382,0.0356409065425396,0.04313872754573822,0.0324905626475811,-0.03435976430773735,0.05788234621286392,0.005486851558089256,-0.015079652890563011,-0.013998034410178661,-0.005331959575414658,-0.005140313412994146,-0.014344572089612484,0.028605135157704353,-0.049523428082466125,0.0014320944901555777,0.008873472921550274,0.016665326431393623,0.02171638049185276,0.016140269115567207,-0.021380344405770302,-0.02404763549566269,-0.01063766609877348,-0.015867238864302635,0.0362289696931839,0.04095448926091194,0.035808924585580826,0.01992068439722061,0.019080592319369316,0.02173738181591034,0.006930759642273188,0.014155551791191101,-0.031167415902018547,-0.008185647428035736,-0.01102620828896761,-0.04118551313877106,0.0009116311557590961,0.017473915591835976,-0.03633398190140724,0.004245090298354626,-0.05069955810904503,-0.0360819548368454,-0.0047360192984342575,-0.004528621211647987,-0.046163059771060944,-0.010726925916969776,-0.00940903089940548,-0.0033183638006448746,-0.03877025097608566,-0.01789396069943905,-0.01416605245321989,0.0030374578200280666,-0.01755792461335659,0.002079227939248085,-0.038581229746341705,0.023942625150084496,0.03835020214319229,-0.00031355780083686113,0.0072037894278764725,-0.017620932310819626,0.0043842303566634655,0.013746006414294243,0.0323435440659523,-0.011971312575042248,0.03435976430773735,0.017379404976963997,-0.0030663360375910997,-0.04658310487866402,-0.006248184945434332,0.023984629660844803,0.003218602854758501,-0.00723529327660799,-0.0019335243850946426,0.04078647121787071,0.013598990626633167,-0.01931161619722843,0.001203038147650659,-0.014575597830116749,0.030999397858977318,-0.043390754610300064,0.0254127848893404,0.00788111425936222,-0.014817124232649803,0.0009116311557590961,0.03186049312353134,0.04297070950269699,-0.010291128419339657,0.010233371518552303,-0.052757780998945236,-0.005190194118767977,-0.0363759882748127,-0.009461537003517151,-0.02040373720228672,0.0020595381502062082,0.00010698047844925895,-0.018534531816840172,0.05956253036856651,0.020298724994063377,0.004006189294159412,0.03158746287226677,-0.01678084023296833,0.04515494778752327,0.0401143953204155,-0.008668700233101845,0.018681548535823822,0.05637018010020256,-0.013157942332327366,-0.07073575258255005,0.011099716648459435,0.003386621130630374,-0.008600442670285702,0.0065947226248681545,-0.03066336177289486,-0.01862904243171215,-0.04775923490524292,-0.07544026523828506,-0.019490135833621025,-0.02203141525387764,0.027302993461489677,-0.04641508683562279,-0.0045653753913939,0.029004178941249847,0.0002858281950466335,-0.0362289696931839,-0.008668700233101845,-0.022094421088695526,-0.0060696653090417385,0.04603704437613487,0.022241437807679176,0.027660030871629715,-0.06519114226102829,-0.02589583769440651,0.031188419088721275,-0.03501083701848984,0.006820497568696737,0.029823269695043564,-0.033834706991910934,0.032595571130514145,0.0028799406718462706,0.011530264280736446,0.08300109952688217,0.013756508007645607,-0.007167035713791847,0.00654221698641777,0.05086757615208626,-0.01156176719814539,-0.0063321939669549465,0.039190296083688736,0.00967681035399437,-0.042004603892564774,0.025055745616555214,-0.014691110700368881,0.003909053280949593,0.012653887271881104,-0.008994235657155514,-0.027239985764026642,0.06456107646226883,-0.007986125536262989,-0.029172196984291077,0.05796635523438454,-0.036754027009010315,-0.015667717903852463,-0.012359854765236378,0.02234645001590252,-0.03511584922671318,-0.0453229695558548,0.01533168088644743,-0.000687825377099216,-0.06540116667747498,-0.013577988371253014,-0.003864423604682088,-0.015688719227910042,-0.01901758462190628,-0.005822888109833002,-0.033183638006448746,0.0117717906832695,-0.046289075165987015,-0.033057622611522675,-0.0024008257314562798,0.011278236284852028,0.02312353439629078,0.003386621130630374,-0.03265858069062233,0.07027370482683182,-0.009860580787062645,0.08069084584712982,-0.046163059771060944,-0.04431485757231712,0.00874220859259367,-0.008332663215696812,0.030411332845687866,-0.016885850578546524,-0.0029692004900425673,-0.023606587201356888,0.056916236877441406,-0.021138817071914673,-0.04448287561535835,0.010380388237535954,-0.008442925289273262,0.024551691487431526,-0.009797574020922184,0.010443395003676414,-0.001476724399253726,-0.0062691872008144855,-0.007035771384835243,0.027387002483010292,0.008175145834684372,-0.009472038596868515,0.016140269115567207,-0.013809013180434704,0.04834729805588722,-0.017326898872852325,-0.058176375925540924,0.0015200416091829538,0.006458207964897156,0.005864892620593309,-0.01593024656176567,-0.008952231146395206,-0.004785899538546801,0.04208861291408539,-0.013462475501000881,-0.012769399210810661,-0.005985656287521124,-0.007224791683256626,-0.007518824189901352,0.0060014077462255955,0.019196104258298874,0.008568938821554184,-0.005368713289499283,-0.04763321951031685,0.012076323851943016,-0.03511584922671318,-0.031146414577960968,0.006116920616477728,0.01933261938393116,-0.02478271722793579,0.011488258838653564,0.00743481470271945,0.004197834990918636,0.011141721159219742,0.015877740457654,-0.011047210544347763,0.0036018947139382362,0.004620506428182125,0.030243314802646637,-0.0005969248013570905,0.024089640006422997,0.005032676737755537,-0.023690596222877502,0.01872355304658413,0.04910338297486305,0.04330674558877945,-0.00160798872821033,-0.005948902107775211,0.041227519512176514,-0.00955604761838913,-0.0022354326210916042,-0.016518309712409973,-0.02528677135705948,0.010448644869029522,-0.0010317381238564849,0.000970700173638761,-0.039526332169771194,-0.008211900480091572,0.035514891147613525,0.02621087245643139,0.039064280688762665,0.008290658704936504,0.027660030871629715,0.0036701522767543793,0.0074715688824653625,0.01463860459625721,0.0249717365950346,0.0007245794404298067,0.028101081028580666,0.01264338567852974,-0.04498692974448204,0.047969259321689606,0.001099995570257306,0.019217105582356453,-0.00033767762943170965,0.008379918523132801,0.006017159670591354,-0.01903858594596386,-0.0019952186848968267,0.012727394700050354,-0.01977366767823696,-0.0012548875529319048,0.02621087245643139,0.007151283789426088,0.01865004375576973,-0.0008341851644217968,-0.004494492430239916,0.012433363124728203,0.005040552467107773,0.00033636498847045004,-0.03280559554696083,-0.003533637383952737,-0.005187568720430136,0.020897289738059044,0.005765132140368223,0.023354560136795044,0.01658131740987301,0.018713051453232765,-0.01285340916365385,0.05048953369259834,0.01015461329370737,-0.003796166041865945,-0.000718672527000308,0.06880354136228561,0.004806901793926954,0.0414375402033329,0.05750430375337601,0.03186049312353134,-0.020414236932992935,0.028437117114663124,0.04141654074192047,-0.04633107781410217,-0.02774404175579548,-0.02047724463045597,0.0020949796307832003,0.010732176713645458,0.03177648410201073,-0.017914963886141777,-0.0009700438240543008,0.0022813749965280294,0.03156645968556404,-0.019154099747538567,0.03270058333873749,-0.041836585849523544,-0.008080636151134968,0.004103324841707945,0.016276784241199493,0.013420470990240574,0.008621444925665855,0.0420256070792675,0.03515785187482834,0.005555109120905399,0.03188149631023407,-0.006437205709517002,0.002245933748781681,0.004145329352468252,0.023690596222877502,-0.0204247385263443,-0.0029035683255642653,0.015363183803856373,-0.010931698605418205,0.01470161136239767,0.005959403235465288,-0.01789396069943905,0.04578501731157303,-0.005786134395748377,0.04124852269887924,0.020267222076654434,-0.006599973421543837,0.0027066715992987156,0.008054383099079132,-0.030117301270365715,-0.0009884207975119352,0.004499743226915598,-0.0254127848893404,0.02417364902794361,0.016528811305761337,-0.020246218889951706,-0.011698282323777676,0.008243403397500515,0.00897323340177536,0.003229103982448578,0.013294457457959652,0.0015712346648797393,0.009283017367124557,-0.006122170947492123,0.05057354271411896,-0.04005138948559761,0.03509484604001045,-0.028584133833646774,-0.0019374623661860824,-0.0278700552880764,-0.009640056639909744,0.0008177771233022213,0.021432848647236824,-0.01615077070891857,-0.010921197012066841,-0.015079652890563011,0.01818799413740635,-0.013220949098467827,0.021149318665266037,-0.02864713966846466,0.0062009296379983425,0.005964653566479683,-0.04683513194322586,0.005006423685699701,-0.0101021071895957,0.054774004966020584,0.042319636791944504,-0.015447192825376987,-0.016791339963674545,0.01539468765258789,-0.006389950402081013,-0.002230182057246566,-0.008416672237217426,0.03314163163304329,0.025076748803257942,0.030537346377968788,0.05284179374575615,0.006179927382618189,0.03700605779886246,-0.012748396955430508,-0.004336975514888763,0.03270058333873749,-0.013157942332327366,-0.032112520188093185,0.015961749479174614,0.015237170271575451,-0.011729785241186619,0.01086869090795517,0.003097839653491974,0.04389481246471405,-0.05649619176983833,-0.007392810191959143,0.030243314802646637,-0.032406553626060486,-0.03992537781596184,0.009697812609374523,0.015216168016195297,-0.006473959423601627,0.0030217061284929514,-0.06204080209136009,-0.02879415638744831,-0.017956968396902084,0.009167504496872425,0.004875159356743097,0.007518824189901352,-0.020025694742798805,0.01378801092505455,-0.018293004482984543,0.017379404976963997,-0.08157294243574142,-0.023501576855778694,0.010837187990546227,0.011530264280736446,-0.008610944263637066,-0.01317894458770752,0.010217620059847832,-0.004507618956267834,0.0372580848634243,0.025034744292497635,-0.013126438483595848,0.0029035683255642653,0.000946416228543967,-0.002155361231416464,-0.03929530829191208,-0.010417141951620579,-0.025307774543762207,0.004591628443449736,-0.032427553087472916,-0.021611368283629417,0.021191323176026344,-0.02154836244881153,0.0012896725675091147,0.03587193042039871,-0.029025182127952576,0.011152222752571106,-0.008773711510002613,0.011288736946880817,-0.043852806091308594,0.05334584787487984,-0.004751770757138729,0.0013421783223748207,-0.0027329246513545513,0.04633107781410217,0.013042429462075233,0.028122082352638245,-0.0056548696011304855,-0.05296780541539192,-0.03700605779886246,0.0009477288695052266,0.01079518347978592,0.03933731094002724,0.004195210058242083,-0.0058701434172689915,-0.027534017339348793,0.02616886794567108,0.025622809305787086,0.034590791910886765,0.010285877622663975,0.001941400347277522,0.02188439853489399,0.033981725573539734,-0.006258686073124409,-0.0016513060545548797,-0.02081328071653843,0.0204247385263443,0.018324509263038635,0.04326474294066429,0.012622383423149586,-0.003047959180548787,0.016444802284240723,0.006526465527713299,0.02513975463807583,0.01962665095925331,0.011698282323777676,0.002874690108001232,0.0064162034541368484,0.011572268791496754,-0.003706906223669648,-0.016675828024744987,0.01884956657886505,-0.029298210516572,0.019343120977282524,-0.03152445703744888,0.03440177068114281,-0.021149318665266037,-0.010459146462380886,0.0018823313293978572,0.004817402921617031,-0.002125170547515154,0.00194533821195364,-0.0019650280009955168,-0.0037935408763587475,0.029004178941249847,0.043222736567258835,-0.023165538907051086,-0.03893826901912689,0.0314614474773407,-0.009025739505887032,0.0056548696011304855,0.022388454526662827,-0.004092823714017868,0.010952700860798359,0.005633867345750332,-0.045196954160928726,0.013914025388658047,0.01687534898519516,0.023816609755158424,0.02509775012731552,0.0008348415140062571,0.0072720469906926155,-0.016675828024744987,-0.018681548535823822,-0.029970284551382065,-0.012727394700050354,0.011876801960170269,-0.021411847323179245,-0.021285833790898323,-0.03778314217925072,-0.009797574020922184,0.01865004375576973,-0.026882946491241455,0.025055745616555214,0.011981813237071037,-0.022094421088695526,-0.0051928190514445305,0.023312555626034737,-0.03171347454190254,-0.01842951960861683,0.035514891147613525,0.01108921505510807,-0.03446477651596069,0.0012568564852699637,0.010879192501306534,-0.012422861531376839,0.016749335452914238,-0.016759837046265602,0.016812343150377274,0.03975735604763031,-0.009251514449715614,0.03202851116657257,-0.014617602340877056,-0.0015869864728301764,-0.03482181578874588,0.019931184127926826,0.02818509005010128,-0.013325960375368595,-0.033183638006448746,0.008684451691806316,-0.00715653458610177,0.00605391338467598,0.020729271695017815,-0.018145989626646042,-0.018377013504505157,0.05027950927615166,-0.001978154294192791,-0.025223765522241592,0.013767008669674397,-0.027912059798836708,0.017620932310819626,-0.00967681035399437,0.006578971166163683,-0.007335054222494364,0.04313872754573822,-0.035031840205192566,-0.006095918361097574,0.034590791910886765,-0.008311660960316658,-0.001231260015629232,0.025685815140604973,-0.0073403045535087585,-0.04021940752863884,0.02293451316654682,0.00939853023737669,0.025685815140604973,-0.040597449988126755,-0.027681034058332443,-0.0054605985060334206,0.03606095165014267,0.004525996278971434,0.002214430132880807,0.02709296904504299,0.03931630775332451,-0.012223339639604092,0.029781265184283257,-0.03465379774570465,-0.005187568720430136,-0.021842394024133682,-0.01400853507220745,0.05473199859261513,-0.00025465289945714176,-0.032427553087472916,-0.026063857600092888,-0.004746520426124334,-0.03748910874128342,0.004153205081820488,0.023900620639324188,0.0018495152471587062,0.018303506076335907,0.0029166946187615395,0.009487790055572987,0.02154836244881153,0.03032732382416725,0.0545639805495739,0.0019138348288834095,0.004851531703025103,-0.04126952216029167,-0.017305897548794746,-0.036312978714704514,0.01894407719373703,-0.009640056639909744,-0.04049243777990341,0.008563688956201077,0.004179458133876324,0.040471434593200684,-0.004145329352468252,0.0062639364041388035,0.014302567578852177,0.023312555626034737,0.006479210220277309,0.005016924813389778,-0.023018522188067436,0.004006189294159412,-0.016014255583286285,-0.027828050777316093,-0.004725518170744181,-0.007928368635475636,0.003244855673983693,-0.007004267536103725,0.0005726409144699574,-0.021947406232357025,0.004045568406581879,-0.016812343150377274,0.020319726318120956,0.02358558587729931,-0.02495073527097702,-0.0022879382595419884,-0.008101638406515121,-0.00627443753182888,0.03421274945139885,0.031062405556440353,0.023228546604514122,0.0137145034968853,0.007088277023285627,-0.01578322984278202,-0.01448108721524477,-0.020529750734567642,-0.003494258038699627,0.030936390161514282,0.04087048023939133,-0.01872355304658413,0.014974641613662243,0.028458118438720703,0.009262015111744404,0.000521447800565511,0.033960722386837006,0.0009949840605258942,-0.027029963210225105,-0.008999486453831196,-0.009377527981996536,-0.00535033643245697,-0.03391871601343155,-0.035661909729242325,-0.01901758462190628,0.015835735946893692,0.011320240795612335,0.01896507851779461,-0.008101638406515121,-0.02217843011021614,-0.009902585297822952,-0.018219497054815292,-0.027323994785547256,0.010375137440860271,0.024740712717175484,0.003937931731343269,0.010406640358269215,-0.02297651767730713,0.011666778475046158,-0.014208056963980198,0.02755502052605152,-0.045364972203969955,0.013357464224100113,-0.009162254631519318,0.024110643193125725,0.013031928800046444,-0.008511182852089405,-0.008920728228986263,-0.009540296159684658,0.045659005641937256,-0.020025694742798805,-0.0008965357556007802,0.004531246609985828,0.008390420116484165,-0.010254373773932457,-0.00569687457755208,-0.0057756332680583,0.003903802949935198,0.04578501731157303,-0.028248095884919167,-0.009456286206841469,-0.021632371470332146,-0.0016657450469210744,0.010254373773932457,-0.028458118438720703,-0.03316263481974602,0.0011072150664404035,-0.03463279455900192,0.018272003158926964,0.0014294692082330585,-0.016822844743728638,0.00804913230240345,-0.004460364114493132,0.021317336708307266,-0.002605598187074065,-0.01731639727950096,-0.011320240795612335,-0.011047210544347763,0.025811828672885895,-0.03654400631785393,0.019007083028554916,-0.011666778475046158,-0.03501083701848984,0.008007127791643143,0.0019939059857279062,0.00276967859826982,-0.04049243777990341,-0.0017340026097372174,-0.027302993461489677,-0.05300981178879738,-0.009009987115859985,-0.014355073682963848,0.0034102487843483686,-0.016843846067786217,0.010301629081368446,0.01162477396428585,-0.010648166760802269,0.014974641613662243,-0.01216033287346363,-0.010385638102889061,0.01485912874341011,-0.011099716648459435,-0.017830954864621162,-0.014334071427583694,-0.005216446705162525,0.0271349735558033,-0.011120718903839588,0.008831468410789967,0.006626226473599672,-0.0025819705333560705,0.02602185308933258,0.007245794404298067,0.0248247217386961,0.011792792938649654,0.04410483315587044,-0.035199858248233795,-0.0035283868201076984,-0.04206760972738266,0.011834797449409962,-0.004142703954130411,0.004132202826440334,-0.0011675967834889889,-0.015741225332021713,-0.001656556618399918,0.01432356983423233,0.02171638049185276,0.0034102487843483686,-0.014890632592141628,0.011530264280736446,0.001097370288334787,-0.00018016037938650697,0.03408673778176308,-0.016381796449422836,0.007167035713791847,-0.00011600489960983396,-0.015321179293096066,0.011656277813017368,0.03761512413620949,0.017589427530765533,-0.0003196287725586444,0.0023063153494149446,-0.02990727871656418,0.014806622639298439,0.0021396095398813486,0.007429564371705055,0.013105436228215694,-0.021905401721596718,0.00302695669233799,-0.020760776475071907,-0.006389950402081013,0.00852168444544077,-0.029928280040621758,0.015541703440248966,0.005754630547016859,0.019679157063364983,-0.014554595574736595,0.003349867183715105,0.007744598668068647,0.027218982577323914,-0.030432336032390594,-0.003827669657766819,0.04494492709636688,0.0163187887519598,0.03230154141783714,-0.01101570762693882,-0.004631007555872202,-0.0068782540038228035,-0.04700315371155739,0.010695422068238258,0.03402372822165489,-0.013830015435814857,0.04124852269887924,0.027197981253266335,0.03183948993682861,0.016056260094046593,0.008243403397500515,0.003378745401278138,-0.03511584922671318,-0.026273880153894424,-0.0320495143532753,0.016833344474434853,-0.020561253651976585,0.016570815816521645,0.0163187887519598,0.023375561460852623,0.006153674330562353,0.001971591031178832,-0.014544093981385231,0.0101021071895957,-0.03856022655963898,0.010186116211116314,0.020802780985832214,-0.029193200170993805,-0.019836673513054848,-0.023753603920340538,0.01668632961809635,0.0077498494647443295,0.025454789400100708,-0.03018030896782875,-0.005016924813389778,0.04406283050775528,0.0034496281296014786,-0.017673436552286148,-0.0025570301804691553,0.012349353171885014,0.033351656049489975,0.03270058333873749,-0.035367876291275024,-0.03414974361658096,-0.01059041079133749,-0.01156176719814539,0.0208657868206501,0.0148696294054389,-0.012422861531376839,-0.004780649207532406,0.006657729856669903,0.00432909931987524,-0.004163706209510565,-0.04700315371155739,-0.016402797773480415,0.000933289818931371,-0.005943651311099529,-0.06279688328504562,0.01648680679500103,-0.025076748803257942,0.010889693163335323,-0.032154522836208344,-0.05502603203058243,0.0014124048175290227,-0.031020401045680046,-0.006473959423601627,0.0204247385263443,-0.006311191711574793,-0.0063531962223351,0.0015056025004014373,0.021285833790898323,-0.017200885340571404,-0.014964140020310879,0.004095449112355709,-0.0359349399805069,-0.02881515771150589,-0.04162656143307686,0.03837120532989502,0.014848627150058746,0.01757892593741417,0.021380344405770302,-0.015300177037715912,-0.013063431717455387,0.020760776475071907,0.024152647703886032,0.03723708167672157,0.003008579835295677,0.013598990626633167,0.019511139020323753,-0.017641933634877205,0.031083406880497932,0.02008870244026184,-0.006605224218219519,-0.020235717296600342,0.02149585634469986,-0.033981725573539734,0.004531246609985828,-0.044902920722961426,0.018692048266530037,0.05733628571033478,-0.021758385002613068,0.0018875818932428956,-0.0001234705705428496,-0.01988917961716652,-0.01757892593741417,-0.005628617014735937,0.011299238540232182,-0.015846237540245056,-0.009298768825829029,0.006300690583884716,-0.009199008345603943,-0.01831400766968727,-0.011320240795612335,0.024404674768447876,0.03956833854317665,0.0356409065425396,0.02081328071653843,0.0018442646833136678,0.032721586525440216,-0.006568470038473606,0.029529236257076263,-0.013472977094352245,0.03538887947797775,0.02027772180736065,0.013210448436439037,0.019763166084885597,0.009220010600984097,0.01576222851872444,0.006479210220277309,0.019931184127926826,0.011383247561752796,0.05179167538881302,-0.02027772180736065,0.016455303877592087,-0.023081529885530472,0.0022682487033307552,-0.01209732610732317,0.03236454725265503,-0.06737538427114487,-0.018229998648166656,-0.02574882283806801,0.004956543445587158,-0.014050540514290333,0.0105431554839015,0.0300332922488451,0.053387850522994995,-0.0011794104939326644,0.00767109077423811,0.00036393050686456263,-0.01317894458770752,0.029823269695043564,-0.024425677955150604,0.0011859737569466233,-0.0033052372746169567,-0.013430972583591938,0.0010291128419339657,-0.012433363124728203,0.015289675444364548,-0.009771320968866348,-0.027681034058332443,0.018975580111145973,0.036291979253292084,-0.025034744292497635,0.0018915198743343353,-0.032742589712142944,-0.01534218154847622,0.019542641937732697,-0.002679106080904603,-0.0031030902173370123,-0.014460084959864616,-0.018082981929183006,0.0022840003948658705,-0.031503453850746155,-0.004242464900016785,0.01833500899374485,-0.010837187990546227,-0.00662097567692399,0.0001674441300565377,0.03387671336531639,0.01070067286491394,-0.002518963534384966,-0.021317336708307266,-0.033183638006448746,0.007503072265535593,0.020382734015583992,-0.03576692193746567,-0.03528386726975441,-0.004851531703025103,-0.010931698605418205,0.005011674482375383,-0.03839220851659775,0.0420256070792675,-0.022304445505142212,0.009923587553203106,0.0035388879477977753,-0.014229059219360352,-0.02866814285516739,0.002210492268204689,0.01432356983423233,-0.016570815816521645,0.036123961210250854,-0.023669594898819923,0.027176978066563606,-0.013798512518405914,-0.014817124232649803,0.028920169919729233,0.0232495479285717,-0.008495431393384933,-0.03173447772860527,-0.032406553626060486,0.00040495063876733184,0.018366513773798943,0.018513528630137444,0.038896262645721436,0.017641933634877205,0.00897323340177536,-0.0001921382499858737,-0.0030637108720839024,-0.04355877265334129,-0.02134883962571621,0.03385571017861366,-0.024593695998191833,-0.0041925846599042416,-0.015699220821261406,-0.016455303877592087,-0.05086757615208626,0.005728377960622311,0.02740800380706787,0.007634336594492197,-0.015699220821261406,0.012968921102583408,-0.00432909931987524,0.0019466509111225605,0.0459110327064991,0.010695422068238258,-0.0017891336465254426,-0.010606162250041962,-0.015625713393092155,-0.04240364953875542,-0.014281565323472023,-0.006421453785151243,-0.01670733094215393,0.025349779054522514,0.01124673243612051,-0.062166813760995865,-0.00831691175699234,0.03032732382416725,0.007461067754775286,0.013546484522521496,0.0014399703359231353,0.010611413046717644,-0.04477690905332565,-0.0278700552880764,0.023942625150084496,-0.036144960671663284,0.002806432545185089,0.007083026226609945,0.0038171682972460985,-0.011141721159219742,0.01763143204152584,0.005927899852395058,-0.05057354271411896,-0.01765243522822857,-0.026714928448200226,-0.017253391444683075,-0.017179882153868675,0.03851822018623352,-0.013252452947199345,-0.0066629801876842976,0.01431306917220354,0.014407578855752945,0.03255356848239899,0.029466230422258377,0.006048663053661585,0.026000849902629852,-0.009986594319343567,-0.010039100423455238,0.029823269695043564,-0.0160982646048069,-0.003827669657766819,-0.010222870856523514,-0.028290100395679474,0.034758809953927994,0.02373260073363781,0.018324509263038635,-0.027218982577323914,-0.0018245750106871128,-0.018986081704497337,-0.007177536841481924,0.0030873382929712534,-0.01733740046620369,0.007560828700661659,0.007146033458411694,0.03223853185772896,-0.032595571130514145,-0.0015515451086685061,0.005376589484512806,-0.01339946873486042,0.019049087539315224,0.006925509311258793,0.020540252327919006,0.03081037662923336,0.00040560695924796164,0.005135063081979752,0.010228120721876621,0.019049087539315224,0.023228546604514122,-0.03417074680328369,-0.03482181578874588,0.01842951960861683,-0.007933619432151318,-0.015069151297211647,0.02264048159122467,0.025937842205166817,0.01738990657031536,0.032112520188093185,-0.0139350276440382,-0.011981813237071037,0.002587221097201109,-0.012937418185174465,-0.045238956809043884,0.04481891170144081,-0.006447706837207079,-0.005555109120905399,0.0010803058976307511,0.01118372566998005,0.01139374915510416,0.014964140020310879,-0.016770338639616966,0.016087763011455536,-0.018996581435203552,-0.01665482483804226,-0.029970284551382065,-0.00789161492139101,0.003612395841628313,0.014806622639298439,-0.019080592319369316,-0.012055321596562862,0.027302993461489677,0.0408494770526886,-0.011278236284852028,0.009582300670444965,-0.03461179509758949,0.00951929297298193,-0.006725987419486046,0.024866726249456406,0.006521214731037617,0.017295395955443382,0.02681993879377842,-0.017400408163666725,0.018082981929183006,-0.0467931292951107,0.031965505331754684,-0.029802266508340836,-0.016507809981703758,0.027534017339348793,-0.017053868621587753,-0.009745067916810513,0.03881225362420082,0.016381796449422836,0.032154522836208344,0.02772303856909275,-0.06027660518884659,0.01410304568707943,0.013914025388658047,-0.017106374725699425,-0.0004899443010799587,0.03034832701086998,-0.02404763549566269,-0.022535469383001328,0.011971312575042248,0.02833210490643978,0.008028130047023296,-0.03171347454190254,-0.009624305181205273,-0.006179927382618189,-0.008075385354459286,0.03956833854317665,-0.016675828024744987,-0.039694350212812424,-0.015499698929488659,0.029676252976059914,0.008952231146395206,-0.006290189456194639,0.007329803425818682]] 
    
    try:
        # Charger les variables d'environnement
        env_path = Path(__file__).parent / '.env'
        load_dotenv(dotenv_path=env_path)

        # R√©cup√©rer les param√®tres de connexion
        milvus_uri = os.environ.get("MILVUS_URI", "tcp://localhost:19530")
        db_name = os.environ.get("MILVUS_DB_NAME", "lightrag")

        # Connexion √† Milvus
        connections.connect(
            alias="default",
            uri=milvus_uri,
            db_name=db_name
        )
        print(f"‚úÖ Connect√© au serveur Milvus")

        # Charger la collection
        collection = Collection(collection_name)
        collection.load()
        print(f"üìö Collection '{collection_name}' charg√©e")

        # Construire l'expression de filtrage si des IDs sont fournis
        if filtered_ids:
            filter_expr = 'id in [' + ', '.join(f'"{id}"' for id in filtered_ids) + ']'
            print(f"üîç Expression de filtrage : {filter_expr}")
        else:
            filter_expr = ""
            print("üåê Aucun filtre d'ID sp√©cifi√©, exportation de toute la collection")

        # Param√®tres de recherche constants
        # search_params = {
        #     "metric_type": "COSINE",  # Utiliser COSINE au lieu de L2
        #     "params": {"nprobe": 10}
        # }

        search_params = {"metric_type": "COSINE"}

        # R√©cup√©rer les donn√©es avec l'expression de filtrage
        results = collection.search(
            data=vec,
            #expr='entity_type == "positive_point"',
            expr=filter_expr,
            param=search_params,
            anns_field="vector",
            output_fields=["id", "entity_name", "entity_type"],
            limit=8  # Ajustez selon la taille de votre collection
        )

        print(f"\nüîç Nombre de r√©sultats trouv√©s : {len(results)}")

        # Si aucun r√©sultat, retourner un DataFrame vide
        if not results:
            return pd.DataFrame()



        for hits in results:
            print("TopK results:")
            for hit in hits:
                print(hit)

        # Convertir les r√©sultats en DataFrame
        df = pd.DataFrame(results)

        # Afficher tous les champs disponibles
        # print("\nüìã Champs disponibles :")
        # for column in df.columns:
        #     print(f"  - {column}")

        return df

    except Exception as e:
        print(f"‚ùå Une erreur s'est produite : {e}")
        return None

    finally:
        # D√©charger la collection et se d√©connecter
        #collection.release()
        #connections.disconnect("default")
        print("üîå D√©connect√© du serveur Milvus")

def main():
    # Exemple d'utilisation
    filtered_ids = [
        "ent-0083fd68b176b558d7f14787622dc9fe"
    ]
    
    # Exporter avec filtrage
    df = export_milvus_to_dataframe(
        collection_name="entities", 
        filtered_ids=filtered_ids
    )

    # Afficher les premi√®res lignes si le DataFrame est cr√©√©
    # if df is not None and not df.empty:
    #     print("\nüìã Aper√ßu du DataFrame :")
    #     print(df)
    #     print("\nüìä Informations sur le DataFrame :")
    #     print(df.info())

if __name__ == "__main__":
    main()




